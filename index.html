<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sistema Herrero - Calculadora de Chapas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="theme-color" content="#ff6b35">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.png">

    <!-- Para iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CalcChapas">
    <link rel="apple-touch-icon" href="icon.png">

    <!-- Para Android -->
    <link rel="icon" type="image/png" href="icon.png">
    
    <style>
   
        * { margin: 0; padding: 0; box-sizing: border-box; transition: all 0.3s ease; }
        
        :root {
            /* VARIABLES POR DEFECTO (Tema Actual) */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #333;
            --accent-primary: #ff6b35;
            --accent-secondary: #3b82f6;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #555;
            --success-color: #10b981;
        }

        body { 
            font-family: Arial, sans-serif; 
            padding: 10px; 
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .container { 
            width: 100%;
            background: var(--bg-secondary);
            padding: 15px; 
            border-radius: 10px;
        }
        
        h2 { 
            font-size: 18px; 
            margin-bottom: 15px; 
            text-align: center;
            color: var(--accent-primary);
        }

        /* SELECTOR DE TEMAS - NUEVO */
        .theme-selector {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            background: var(--bg-tertiary);
            padding: 8px;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .theme-btn {
            flex: 1;
            padding: 10px 5px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 60px;
        }

        .theme-btn.active {
             background: var(--bg-secondary); /* Fondo normal */
             color: var(--text-primary);
             transform: translateY(-2px);
             border: 2px solid var(--accent-primary);
             box-shadow: 0 0 10px var(--accent-primary);
        }

        /* Bordes espec√≠ficos por tema */
        [data-tema="tron"].active {
             border: 2px solid #00f3ff !important;
             box-shadow: 0 0 15px #00f3ff !important;
        }

        [data-tema="batman"].active {
             border: 2px solid #ffff00 !important;
             box-shadow: 0 0 15px #ffff00 !important;
        }

        [data-tema="fundicion"].active {
             border: 2px solid #ff4444 !important;
             box-shadow: 0 0 15px #ff4444 !important;
        }

        [data-tema="starwars"].active {
             border: 2px solid #9966cc !important;
             box-shadow: 0 0 15px #9966cc !important;
        }  
      
        .configuracion {
            background: var(--bg-tertiary);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .config-pintura {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
        }
        
        .config-pintura input {
            width: 120px;
            padding: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        
        .selector-principal {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .boton-opcion {
            flex: 1;
            padding: 14px 8px;
            font-size: 12px;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            position: relative;
        }
        
        .boton-opcion.activo {
            background: var(--accent-primary);
            color: var(--text-primary);
        }
        
        /* ESTILO PARA OPCI√ìN BLOQUEADA (PRO) */
        .boton-opcion.pro-bloqueado {
            background: #555 !important;
            color: #888 !important;
            cursor: not-allowed;
            opacity: 0.7;
            border: 1px solid #666;
        }
        
        .boton-opcion.pro-bloqueado::after {
            content: "PRO";
            position: absolute;
            top: -6px;
            right: -6px;
            background: #ff4444;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .boton-opcion:hover:not(.pro-bloqueado) {
            background: #555;
        }
        
        .boton-opcion.activo {
            background: var(--bg-tertiary); /* Fondo normal */
            color: var(--text-primary);
            border: 2px solid var(--accent-primary);
            box-shadow: 0 0 15px var(--accent-primary),
                                    0 0 25px var(--accent-primary) inset;
            position: relative;
        }

        /* Efecto ne√≥n adicional para algunos temas */
        .tema-tron .boton-opcion.activo {
            border: 2px solid #00f3ff;
            box-shadow: 0 0 20px #00f3ff,
                                    0 0 30px rgba(0, 243, 255, 0.3) inset;
            text-shadow: 0 0 10px #00f3ff;
        }

        .tema-batman .boton-opcion.activo {
             border: 2px solid #ffff00;
             box-shadow: 0 0 20px #ffff00,
                                     0 0 30px rgba(255, 255, 0, 0.3) inset;
             text-shadow: 0 0 10px #ffff00;
         }

         .tema-fundicion .boton-opcion.activo {
             border: 2px solid #ff4444;
             box-shadow: 0 0 20px #ff4444,
                                     0 0 30px rgba(255, 68, 68, 0.3) inset;
             text-shadow: 0 0 10px #ff4444;
         }

         .tema-starwars .boton-opcion.activo {
             border: 2px solid #9966cc;
             box-shadow: 0 0 20px #9966cc,
                                     0 0 30px rgba(153, 102, 204, 0.3) inset;
             text-shadow: 0 0 10px #9966cc;
         }
        
        .opcion-contenido {
            display: none;
        }
        
        .opcion-contenido.activo {
            display: block;
        }
        
        .selectores-categoria {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .selectores-categoria select {
            flex: 1;
            min-width: 0;
            padding: 12px;
            font-size: 14px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        
        .controles-compactos {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .controles-compactos input {
            flex: 1;
            min-width: 0;
            padding: 12px;
            font-size: 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        
        .botones-compactos {
            display: flex;
            gap: 8px;
            margin: 15px 0;
        }
        
        .botones-compactos button {
            flex: 1;
            padding: 14px 10px;
            font-size: 14px;
            background: var(--accent-primary);
            color: var(--text-primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        /* Efecto ne√≥n al hacer hover en botones principales */
        .botones-compactos button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

       .botones-compactos button:hover {
            border: 2px solid var(--accent-primary);
            box-shadow: 0 0 15px var(--accent-primary);
        }

        /* Efectos espec√≠ficos por tema en hover */
        .tema-tron .botones-compactos button:hover {
            border: 2px solid #00f3ff;
            box-shadow: 0 0 20px #00f3ff;
        }

        .tema-batman .botones-compactos button:hover {
            border: 2px solid #ffff00;
            box-shadow: 0 0 20px #ffff00;
       }

       .tema-fundicion .botones-compactos button:hover {
           border: 2px solid #ff4444;
           box-shadow: 0 0 20px #ff4444;
       }

       .tema-starwars .botones-compactos button:hover {
           border: 2px solid #9966cc;
           box-shadow: 0 0 20px #9966cc;
       }

        .botones-pdf {
            display: flex;
            gap: 8px;
            margin: 10px 0;
        }

        .botones-pdf button {
            flex: 1;
            padding: 12px 8px;
            font-size: 12px;
            background: var(--accent-secondary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .botones-pdf button:hover {
            filter: brightness(1.1);
        }
        
        .item-mini {
            background: var(--bg-tertiary);
            padding: 12px;
            margin: 6px 0;
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mensaje-exito {
            background: var(--success-color);
            color: var(--text-primary);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            text-align: center;
            display: none;
        }
        
        .acordeon-cabecera {
            background: var(--accent-primary);
            padding: 14px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            transition: background 0.3s;
        }
        
        .acordeon-cabecera:hover {
            filter: brightness(1.1);
        }
        
        .acordeon-contenido {
            display: none;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 0 0 6px 6px;
        }
        
        .tipo-mini {
            margin: 8px 0;
            padding: 10px;
            border-radius: 5px;
            background: var(--bg-tertiary);
        }
        
        .rojo { border-left: 4px solid #dc2626; }
        .azul { border-left: 4px solid #2563eb; }
        .verde { border-left: 4px solid #16a34a; }
        
        .total-mini {
            background: var(--accent-primary);
            padding: 15px;
            border-radius: 6px;
            margin-top: 12px;
            font-weight: bold;
        }
        
        .resumen-linea {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
        }
        
        .info-extra {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .pintura-info {
            background: var(--bg-tertiary);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #f59e0b;
        }
        
        .switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 8px 0;
        }

        .config-profundidad {
            background: var(--bg-tertiary);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid var(--accent-secondary);
        }

        /* MODAL PRO - NUEVO */
        .modal-pro {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-contenido {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 300px;
            text-align: center;
            border: 2px solid var(--accent-primary);
        }

        .modal-contenido h3 {
            color: var(--accent-primary);
            margin-bottom: 15px;
        }

        .modal-contenido button {
            margin-top: 15px;
            padding: 10px 20px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        /* REBAJE FIJO - NUEVO */
        .rebaje-fijo {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            border-left: 4px solid var(--success-color);
        }

        /* ============ TEMAS √âPICOS ============ */

        /* TEMA TRON */
        .tema-tron {
            --bg-primary: #0a0a0a;
            --bg-secondary: #0c0c1a;
            --bg-tertiary: #000;
            --accent-primary: #00f3ff;
            --accent-secondary: #0080ff;
            --text-primary: #ffffff;
            --text-secondary: #00f3ff;
            --border-color: #00f3ff;
            --success-color: #00ffaa;
        }

        .tema-tron .container {
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            border: 1px solid var(--border-color);
        }

        .tema-tron input,
        .tema-tron select {
            background: rgba(0, 243, 255, 0.1);
            border-color: var(--accent-primary);
        }

        /* TEMA BATMAN */
        .tema-batman {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a0a0a;
            --accent-primary: #ffff00;
            --accent-secondary: #ff6600;
            --text-primary: #ffffff;
            --text-secondary: #ffff00;
            --border-color: #333;
            --success-color: #00ff00;
        }

        .tema-batman .container {
            box-shadow: 0 0 15px rgba(255, 255, 0, 0.2);
        }

        .tema-batman .boton-opcion.activo {
            border: 2px solid #ffff00;
            box-shadow: 0 0 10px #ffff00;
        }

        /* TEMA FUNDICI√ìN */
        .tema-fundicion {
            --bg-primary: #1a0a0a;
            --bg-secondary: #2a0a0a;
            --bg-tertiary: #3a0a0a;
            --accent-primary: #ff4444;
            --accent-secondary: #ff6b6b;
            --text-primary: #e8e8e8;
            --text-secondary: #ff6b6b;
            --border-color: #8b0000;
            --success-color: #ffaa00;
        }

        .tema-fundicion .boton-opcion.activo {
            background: linear-gradient(45deg, #8b0000, #ff4444);
        }

        /* TEMA STAR WARS */
        .tema-starwars {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --accent-primary: #9966cc;
            --accent-secondary: #ffeb99;
            --text-primary: #ffeb99;
            --text-secondary: #ccccff;
            --border-color: #444;
            --success-color: #66ff99;
        }

        .tema-starwars .container {
            backdrop-filter: blur(5px);
        }

        .tema-starwars .boton-opcion.activo {
            background: linear-gradient(45deg, #4a2a4a, #9966cc);
        }

        @media print {
            body { 
                background: white !important; 
                color: black !important; 
                padding: 0;
                margin: 0;
            }
            .container { 
                background: white !important; 
                box-shadow: none !important;
                padding: 10px;
                margin: 0;
            }
            .theme-selector, .selector-principal, .botones-compactos, .botones-pdf, 
            .configuracion, .controles-compactos, .selectores-categoria, 
            .acordeon-cabecera, .modal-pro { 
                display: none !important; 
            }
            .acordeon-contenido { 
                display: block !important; 
                background: white !important;
                color: black !important;
                padding: 0 !important;
            }
            .tipo-mini, .pintura-info, .total-mini {
                background: white !important;
                color: black !important;
                border: 1px solid #ddd !important;
                margin: 10px 0 !important;
            }
            .rojo, .azul, .verde {
                border-left: 4px solid #666 !important;
            }
            .info-extra {
                color: #666 !important;
            }
        }
    </style>
</head>
<body class="tema-actual">
    <div class="container">
        <h2>CALCULADORA DE CHAPAS PARA FRENTES</h2>
        
        <!-- Selector de Temas √âpicos -->
        <div class="theme-selector">
            <button class="theme-btn active" data-tema="actual">ACTUAL</button>
            <button class="theme-btn" data-tema="tron">TRON</button>
            <button class="theme-btn" data-tema="batman">BATMAN</button>
            <button class="theme-btn" data-tema="fundicion">FUNDICI√ìN</button>
            <button class="theme-btn" data-tema="starwars">STAR WARS</button>
        </div>
        
        <!-- Selector de Opci√≥n con Botones -->
        <div class="selector-principal">
            <button class="boton-opcion activo" data-opcion="A">FRENTE GABINETE</button>
            <button class="boton-opcion pro-bloqueado" data-opcion="B">MARCO PUERTA</button>
        </div>
        
        <!-- Configuraci√≥n de Precios -->
        <div class="configuracion">
            <div class="config-pintura">
                <span>Precio por kg de chapa:</span>
                <input type="number" id="precioKg" placeholder="7000" min="0" step="100">
                <span>$/kg</span>
            </div>
            <div class="config-pintura">
                <span>Precio pintura por litro:</span>
                <input type="number" id="precioPintura" placeholder="18000" min="0" step="1000">
                <span>$/L</span>
            </div>
            <div class="switch">
                <span>Incluir factura:</span>
                <label>
                    <input type="checkbox" id="conFactura"> 
                    <span style="margin-left: 8px;">S√ç (+15%)</span>
                </label>
            </div>
        </div>
        
        <!-- OPCI√ìN A: Frente Gabinete -->
        <div id="opcion-A" class="opcion-contenido activo">
            <!-- REBAJE FIJO 0.03m - NUEVO -->
            <div class="rebaje-fijo">
                ‚öôÔ∏è Rebaje fijo: <strong>0.03m</strong> | Desarrollo: <strong>0.19m</strong>
            </div>
            
            <div class="controles-compactos">
                <input type="number" id="altoTotalA" placeholder="Alto total (m)" step="0.01" min="0">
                <input type="number" id="anchoTotalA" placeholder="Ancho total (m)" step="0.01" min="0">
                <input type="number" id="cantPuertasA" placeholder="Cant. puertas" min="1">
            </div>
            
            <div class="configuracion">
                <div class="selectores-categoria">
                    <select id="tipoChapaA">
                        <option value="n18">Chapa N¬∞18 (11kg/m¬≤)</option>
                        <option value="n20">Chapa N¬∞20 (9kg/m¬≤)</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- OPCI√ìN B: Marco Puerta (BLOQUEADA) -->
        <div id="opcion-B" class="opcion-contenido">
            <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                <h3>üîí FUNCI√ìN PRO</h3>
                <p>Esta funci√≥n est√° disponible en la versi√≥n completa.</p>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,68,68,0.1); border-radius: 8px;">
                    <strong>Contactame para acceder a todas las funciones:</strong>
                    <p style="margin-top: 10px; color: var(--accent-primary);">
                        ‚Ä¢ Marcos puerta personalizados<br>
                        ‚Ä¢ M√∫ltiples opciones de rebaje<br>
                        ‚Ä¢ C√°lculos avanzados<br>
                        ‚Ä¢ Sin l√≠mites de uso
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Mensaje de √©xito -->
        <div class="mensaje-exito" id="mensajeExito"></div>
        
        <!-- Botones principales -->
        <div class="botones-compactos">
            <button onclick="calcularChapas()">CALCULAR CHAPAS</button>
            <button onclick="limpiarCalculadora()">LIMPIAR TODO</button>
        </div>

        <!-- Botones PDF e Imprimir -->
        <div class="botones-pdf">
            <button onclick="imprimirResultados()">IMPRIMIR / GUARDAR PDF</button>
        </div>
        
        <!-- Resultados -->
        <div class="acordeon">
            <div class="acordeon-cabecera" onclick="toggleAcordeon('resultadosChapas')">
                VER RESULTADOS COMPLETOS
            </div>
            <div class="acordeon-contenido" id="resultadosChapas"></div>
        </div>
    </div>

    <!-- Modal PRO -->
    <div class="modal-pro" id="modalPro">
        <div class="modal-contenido">
            <h3>‚ö° FUNCI√ìN PRO</h3>
            <p>La opci√≥n <strong>MARCO PUERTA</strong> est√° disponible en la versi√≥n completa.</p>
            <p style="margin: 15px 0; font-size: 13px; color: var(--text-secondary);">
                Contactame para acceder a todas las funciones avanzadas.
            </p>
            <button onclick="cerrarModalPro()">ENTENDIDO</button>
        </div>
    </div>

    <script>
        // =============================================
        // SISTEMA DE TEMAS PERSISTENTE
        // =============================================
        document.querySelectorAll('.theme-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const tema = this.dataset.tema;
                document.body.className = `tema-${tema}`;
                
                localStorage.setItem('tema-calculadora', tema);
            });
        });

        // Cargar tema guardado
        const temaGuardado = localStorage.getItem('tema-calculadora') || 'actual';
        document.querySelector(`[data-tema="${temaGuardado}"]`).classList.add('active');
        document.body.className = `tema-${temaGuardado}`;

        // =============================================
        // VALIDACI√ìN CONTRA NEGATIVOS Y DECIMALES
        // =============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Prevenir valores negativos
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', function() {
                    if (this.value.startsWith('-')) {
                        this.value = this.value.replace('-', '');
                    }
                    
                    // Limitar a 2 decimales
                    if (this.value.includes('.')) {
                        const partes = this.value.split('.');
                        if (partes[1].length > 2) {
                            this.value = parseFloat(this.value).toFixed(2);
                        }
                    }
                });
                
                // Validar al perder foco
                input.addEventListener('blur', function() {
                    if (this.value.trim() !== '') {
                        const valor = parseFloat(this.value);
                        if (isNaN(valor) || valor < 0) {
                            this.value = '';
                            mostrarMensaje('‚ùå Ingres√° un n√∫mero v√°lido (mayor o igual a 0)');
                        }
                    }
                });
            });
        });

        // =============================================
        // BLOQUEO OPCI√ìN B (MARCO PUERTA)
        // =============================================
        document.querySelectorAll('.boton-opcion').forEach(boton => {
            boton.addEventListener('click', function() {
                // Si es la opci√≥n B (bloqueada), mostrar modal
                if (this.classList.contains('pro-bloqueado')) {
                    mostrarModalPro();
                    return;
                }
                
                // Si es la opci√≥n A, cambiar normalmente
                document.querySelectorAll('.boton-opcion').forEach(b => {
                    b.classList.remove('activo');
                    if (!b.classList.contains('pro-bloqueado')) {
                        b.classList.remove('activo');
                    }
                });
                this.classList.add('activo');
                
                const opcion = this.dataset.opcion;
                document.querySelectorAll('.opcion-contenido').forEach(div => div.classList.remove('activo'));
                document.getElementById(`opcion-${opcion}`).classList.add('activo');
            });
        });

        // =============================================
        // MODAL PRO
        // =============================================
        function mostrarModalPro() {
            document.getElementById('modalPro').style.display = 'flex';
        }

        function cerrarModalPro() {
            document.getElementById('modalPro').style.display = 'none';
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('modalPro').addEventListener('click', function(e) {
            if (e.target === this) {
                cerrarModalPro();
            }
        });

        // =============================================
        // CONSTANTES Y CLASE CALCULADORA (MODIFICADA)
        // =============================================
        const REBAJE_FIJO = 0.03;
        const DESARROLLO_FIJO = 0.19; // 0.16 + 0.03

        class CalculadoraChapas {
            constructor(precioKg = 7000, precioPintura = 18000) {
                this.precioBaseKg = precioKg;
                this.precioPinturaLitro = precioPintura;
                this.pesosChapa = {'n18': 11, 'n20': 9};
            }
            
            calcularMlMarcoA(alto, ancho) {
                return (alto * 2) + (ancho * 2);
            }
            
            calcularDesarrolloMarcoA() {
                return DESARROLLO_FIJO; // Fijo 0.19m
            }
            
            calcularProfundidadPuerta() {
                return (REBAJE_FIJO + 0.015) * 2;
            }
            
            calcularDesarrolloOmega() {
                return (0.015 * 2) + (REBAJE_FIJO * 2) + 0.1;
            }
            
            calcularOpcionA(datos) {
                try {
                    const mlMarco = this.calcularMlMarcoA(datos.altoTotal, datos.anchoTotal);
                    const desarrollo = this.calcularDesarrolloMarcoA();
                    const m2Marco = mlMarco * desarrollo;
                    
                    const mlProfundidadPuerta = this.calcularProfundidadPuerta();
                    const mlProfundidadTotal = mlProfundidadPuerta * datos.cantPuertas;
                    
                    const factorMarco = datos.cantPuertas > 2 ? 3 : 2;
                    
                    const mlAltoPuertas = (datos.altoTotal + mlProfundidadTotal) - (0.03 * 2);
                    const mlAnchoPuertas = (datos.anchoTotal + mlProfundidadTotal) - (0.03 * factorMarco);
                    const m2Puertas = mlAltoPuertas * mlAnchoPuertas;
                    
                    const desarrolloOmega = this.calcularDesarrolloOmega();
                    let m2Omega = datos.anchoTotal * desarrolloOmega;
                    
                    if (datos.altoTotal > 1.5) {
                        m2Omega *= 2;
                    }
                    
                    const m2Totales = m2Marco + m2Puertas + m2Omega;
                    
                    return this._calcularResultadosFinales(m2Totales, datos);
                    
                } catch (e) {
                    console.error("Error en c√°lculo Opci√≥n A:", e);
                    return null;
                }
            }
            
            _calcularResultadosFinales(m2Totales, datos) {
                try {
                    const pesoPorM2 = this.pesosChapa[datos.tipoChapa];
                    
                    // üö® CAMBIO 1: SIN 10% DESPERDICIO
                    const kgChapa = m2Totales * pesoPorM2; // ‚Üê Quitamos * 1.1
                    
                    const costoChapa = kgChapa * this.precioBaseKg;
                    
                    // C√°lculo pintura
                    const m2Pintura = m2Totales * 2;
                    const litrosPintura = Math.ceil((m2Pintura * 2) / 10);
                    const costoPintura = litrosPintura * this.precioPinturaLitro;
                    const combinacionLatas = this.calcularLatasPintura(litrosPintura);
                    
                    // üö® CAMBIO 2: SIN 30% MATERIALES EXTRAS
                    const costoMateriales = costoChapa + costoPintura; // ‚Üê Quitamos * 1.3
                    
                    // üö® CAMBIO 3: MANO DE OBRA = MATERIAL √ó 1 (TOTAL √ó 2)
                    const costoFinalSinFactura = costoMateriales * 2; // ‚Üê Antes: totalConMateriales √ó 2
                    const costoFinalConFactura = datos.conFactura ? costoFinalSinFactura * 1.15 : costoFinalSinFactura;
                    
                    return {
                        m2Totales: Number(m2Totales.toFixed(4)),
                        kgChapa: Number(kgChapa.toFixed(2)), // ‚Üê Cambiado de kgConDesperdicio
                        rebajeUsado: REBAJE_FIJO,
                        desarrolloUsado: DESARROLLO_FIJO,
                        precioKgUsado: this.precioBaseKg,
                        precioPinturaUsado: this.precioPinturaLitro,
                        costoChapa: Number(costoChapa.toFixed(2)),
                        costoPintura: Number(costoPintura.toFixed(2)),
                        costoMateriales: Number(costoMateriales.toFixed(2)),
                        costoFinalSinFactura: Number(costoFinalSinFactura.toFixed(2)),
                        costoFinalConFactura: Number(costoFinalConFactura.toFixed(2)),
                        litrosPintura: litrosPintura,
                        combinacionLatas: combinacionLatas,
                        conFactura: datos.conFactura
                    };
                    
                } catch (e) {
                    console.error("Error en c√°lculos finales:", e);
                    return null;
                }
            }
            
            calcularLatasPintura(litros) {
                let latas = [];
                let litrosRestantes = litros;
                
                const latas4L = Math.floor(litrosRestantes / 4);
                if (latas4L > 0) {
                    latas.push(`${latas4L} lata${latas4L > 1 ? 's' : ''} de 4L`);
                    litrosRestantes -= latas4L * 4;
                }
                
                if (litrosRestantes > 0) {
                    latas.push(`${litrosRestantes} lata${litrosRestantes > 1 ? 's' : ''} de 1L`);
                }
                
                return latas.join(' + ');
            }
        }

        // =============================================
        // VARIABLES GLOBALES
        // =============================================
        let calculadoraChapas = new CalculadoraChapas();
        let contadorPresupuestos = localStorage.getItem('contadorPresupuestos') || 1;

        // =============================================
        // MANEJAR PRECIOS (actualizar + guardar)
        // =============================================

        function actualizarCalculadora() {
            const precioKg = parseFloat(document.getElementById('precioKg').value) || 7000;
            const precioPintura = parseFloat(document.getElementById('precioPintura').value) || 18000;
            calculadoraChapas = new CalculadoraChapas(precioKg, precioPintura);
        }

        // Cuando cambia precio Kg
        document.getElementById('precioKg').addEventListener('change', function() {
            if (this.value) {
                // Guardar en localStorage
                localStorage.setItem('precioKg', this.value);
                console.log('üí∞ Precio kg guardado:', this.value);
                // Actualizar calculadora
                actualizarCalculadora();
            }
        });

        // Cuando cambia precio pintura
        document.getElementById('precioPintura').addEventListener('change', function() {
            if (this.value) {
                // Guardar en localStorage
                localStorage.setItem('precioPintura', this.value);
                console.log('üé® Precio pintura guardado:', this.value);
                // Actualizar calculadora
                actualizarCalculadora();
            }
        });

        // Cargar precios guardados al iniciar
        document.addEventListener('DOMContentLoaded', function() {
            const precioKgGuardado = localStorage.getItem('precioKg');
            const precioPinturaGuardado = localStorage.getItem('precioPintura');
    
            if (precioKgGuardado) {
                document.getElementById('precioKg').value = precioKgGuardado;
                console.log('üí∞ Precio kg cargado:', precioKgGuardado);
            }
    
            if (precioPinturaGuardado) {
                document.getElementById('precioPintura').value = precioPinturaGuardado;
                console.log('üé® Precio pintura cargado:', precioPinturaGuardado);
            }
    
            // Actualizar calculadora con los precios cargados
            actualizarCalculadora();
        });

        //=================================
        // FUNCIONES DE INTERFAZ
        // =============================================
        function mostrarMensaje(mensaje) {
            const mensajeExito = document.getElementById('mensajeExito');
            mensajeExito.textContent = `${mensaje} | Presupuesto N¬∞ ${String(contadorPresupuestos).padStart(3, '0')} | ${new Date().toLocaleDateString()}`;
            mensajeExito.style.display = 'block';
            setTimeout(() => {
                mensajeExito.style.display = 'none';
            }, 5000);
        }

        function toggleAcordeon(id) {
            const contenido = document.getElementById(id);
            contenido.style.display = contenido.style.display === 'block' ? 'none' : 'block';
        }

        function limpiarCalculadora() {
            document.querySelectorAll('input[type="number"]').forEach(input => {
                if (!input.id.includes('precio')) {
                    if (input.id === 'cantPuertasA') {
                        input.value = '1';
                    } else {
                        input.value = '';
                    }
                }
            });
            document.getElementById('resultadosChapas').innerHTML = '';
            document.getElementById('resultadosChapas').style.display = 'none';
            mostrarMensaje('üîÑ Calculadora limpiada');
        }

        function imprimirResultados() {
            const resultados = document.getElementById('resultadosChapas');
            if (resultados.innerHTML.trim() === '') {
                alert('Primero calcul√° el proyecto');
                return;
            }
            resultados.style.display = 'block';
            setTimeout(() => window.print(), 100);
        }

        // =============================================
        // FUNCI√ìN PRINCIPAL DE C√ÅLCULO
        // =============================================
        function calcularChapas() {
            try {
                const opcionActiva = document.querySelector('.boton-opcion.activo').dataset.opcion;
                const conFactura = document.getElementById('conFactura').checked;

                // Validar que sea la opci√≥n A (√∫nica permitida)
                if (opcionActiva !== 'A') {
                    mostrarModalPro();
                    return;
                }

                // Obtener y validar valores
                const altoTotal = parseFloat(document.getElementById('altoTotalA').value);
                const anchoTotal = parseFloat(document.getElementById('anchoTotalA').value);
                const cantPuertas = parseInt(document.getElementById('cantPuertasA').value);
                const tipoChapa = document.getElementById('tipoChapaA').value;

                // Validaciones b√°sicas
                if (!altoTotal || !anchoTotal || !cantPuertas) {
                    mostrarMensaje('‚ùå Complet√° todos los campos obligatorios');
                    return;
                }

                if (altoTotal <= 0 || anchoTotal <= 0) {
                    mostrarMensaje('‚ùå Alto y ancho deben ser mayores a 0');
                    return;
                }

                if (cantPuertas < 1) {
                    mostrarMensaje('‚ùå La cantidad de puertas debe ser al menos 1');
                    return;
                }

                const datos = { 
                    altoTotal, 
                    anchoTotal, 
                    cantPuertas, 
                    tipoChapa, 
                    conFactura 
                };

                const resultados = calculadoraChapas.calcularOpcionA(datos);

                if (!resultados) {
                    mostrarMensaje('‚ùå Error en los c√°lculos');
                    return;
                }

                mostrarResultados(resultados);
                contadorPresupuestos++;
                localStorage.setItem('contadorPresupuestos', contadorPresupuestos);
                mostrarMensaje(`‚úÖ Frente gabinete calculado (Rebaje: 0.03m)`);

            } catch (error) {
                mostrarMensaje(`‚ùå Error: ${error.message}`);
            }
        }

        // =============================================
        // MOSTRAR RESULTADOS
        // =============================================
        function mostrarResultados(resultados) {
            const contenedor = document.getElementById('resultadosChapas');
            
            let html = `
                <div class="info-extra" style="margin-bottom: 15px; text-align: center;">
                    FRENTE GABINETE | PRESUPUESTO N¬∞ ${String(contadorPresupuestos).padStart(3, '0')} | ${new Date().toLocaleDateString()}
                </div>
                
                <div class="tipo-mini rojo">
                    <strong>CONFIGURACI√ìN USADA</strong>
                    <div class="resumen-linea">
                        <span>Rebaje:</span>
                        <span>${resultados.rebajeUsado} m (FIJO)</span>
                    </div>
                    <div class="resumen-linea">
                        <span>Desarrollo marco:</span>
                        <span>${resultados.desarrolloUsado} m</span>
                    </div>
                    <div class="resumen-linea">
                        <span>Precio kg chapa:</span>
                        <span>$${resultados.precioKgUsado.toLocaleString()}</span>
                    </div>
                    <div class="resumen-linea">
                        <span>Precio pintura:</span>
                        <span>$${resultados.precioPinturaUsado.toLocaleString()}/L</span>
                    </div>
                </div>
                
                <div class="tipo-mini azul">
                    <strong>MEDIDAS Y PESOS</strong>
                    <div class="resumen-linea">
                        <span>Metros cuadrados:</span>
                        <span>${resultados.m2Totales} m¬≤</span>
                    </div>
                    <div class="resumen-linea">
                        <span>Kg chapa (sin desperdicio):</span>
                        <span>${resultados.kgChapa} kg</span>
                    </div>
                </div>
                
                <div class="pintura-info">
                    <strong>PINTURA</strong>
                    <div class="resumen-linea">
                        <span>Litros necesarios:</span>
                        <span>${resultados.litrosPintura} litros</span>
                    </div>
                    <div class="resumen-linea">
                        <span>Costo pintura:</span>
                        <span>$${resultados.costoPintura.toLocaleString()}</span>
                    </div>
                    <div class="resumen-linea" style="font-weight: bold; color: var(--accent-primary);">
                        <span>Combinaci√≥n √≥ptima:</span>
                        <span>${resultados.combinacionLatas}</span>
                    </div>
                </div>
                
                <div class="tipo-mini verde">
                    <strong>DESGLOSE DE COSTOS</strong>
                    <div class="resumen-linea">
                        <span>Costo chapa:</span>
                        <span>$${resultados.costoChapa.toLocaleString()}</span>
                    </div>
                    <div class="resumen-linea">
                        <span>Costo pintura:</span>
                        <span>$${resultados.costoPintura.toLocaleString()}</span>
                    </div>
                    <div class="resumen-linea" style="border-top: 1px solid var(--border-color); padding-top: 8px;">
                        <span><strong>Total materiales (chapa + pintura):</strong></span>
                        <span><strong>$${resultados.costoMateriales.toLocaleString()}</strong></span>
                    </div>
                    <div class="resumen-linea" style="border-top: 1px solid var(--border-color); padding-top: 8px;">
                        <span>+ 100% mano de obra/ganancia:</span>
                        <span>$${resultados.costoFinalSinFactura.toLocaleString()}</span>
                    </div>`;

            if (resultados.conFactura) {
                html += `
                    <div class="resumen-linea">
                        <span>+ 15% factura:</span>
                        <span>$${resultados.costoFinalConFactura.toLocaleString()}</span>
                    </div>`;
            }

            html += `
                    <div class="resumen-linea" style="border-top: 2px solid var(--accent-primary); padding-top: 8px; font-weight: bold;">
                        <span>TOTAL FINAL:</span>
                        <span>$${(resultados.conFactura ? resultados.costoFinalConFactura : resultados.costoFinalSinFactura).toLocaleString()}</span>
                    </div>
                </div>
                
                <div class="info-extra" style="margin-top: 15px; text-align: center; font-size: 11px;">
                    üìå <strong>Versi√≥n b√°sica</strong> - Rebaje fijo 0.03m<br>
                    ‚ö° <strong>Versi√≥n PRO</strong> disponible con m√°s funciones
                </div>`;

            contenedor.innerHTML = html;
            contenedor.style.display = 'block';
        }

       // =============================================
       // INICIALIZACI√ìN + PWA
       // =============================================

       // 1. INICIALIZACI√ìN
       document.addEventListener('DOMContentLoaded', function() {
           console.log('Calculadora de Frentes - Versi√≥n Influencer/Herreros cargada');
           console.log('Caracter√≠sticas: Rebaje fijo 0.03m, sin desperdicio 10%, sin materiales 30%');
       });

       // 2. REGISTRAR SERVICE WORKER
       if ('serviceWorker' in navigator) {
           window.addEventListener('load', function() {
               navigator.serviceWorker.register('/sw.js')
                   .then(function(registration) {
                       console.log('‚úÖ Service Worker registrado:', registration.scope);
                   })
                   .catch(function(error) {
                     console.log('‚ùå Error registrando Service Worker:', error);
                });
            });
        }

// =============================================
// BOT√ìN DE INSTALACI√ìN MEJORADO
// =============================================

let botonInstalar = null;

// Funci√≥n para verificar si YA est√° instalada
function verificarSiYaEstaInstalada() {
    // M√©todo 1: display-mode (est√°ndar)
    if (window.matchMedia('(display-mode: standalone)').matches) {
        console.log('üì± Ya est√° instalada (display-mode)');
        return true;
    }
    
    // M√©todo 2: navigator.standalone (iOS)
    if (window.navigator.standalone === true) {
        console.log('üì± Ya est√° instalada (iOS)');
        return true;
    }
    
    // M√©todo 3: localStorage (nuestra marca)
    if (localStorage.getItem('pwa_instalada') === 'true') {
        console.log('üì± Marcada como instalada en localStorage');
        return true;
    }
    
    return false;
    }

    function crearBotonInstalacion() {
    // Si ya est√° instalada, NO crear bot√≥n
    if (verificarSiYaEstaInstalada()) {
        console.log('‚úÖ Ya instalada, sin bot√≥n');
        return;
    }
    
    // Si ya existe bot√≥n, no crear otro
    if (botonInstalar) return;
    
    // Crear bot√≥n
    botonInstalar = document.createElement('button');
    botonInstalar.innerHTML = 'üì± INSTALAR APP';
    botonInstalar.id = 'boton-instalar-app';
    
    // Estilo
    botonInstalar.style.cssText = `
        position: fixed;
        bottom: 80px;
        right: 20px;
        padding: 14px 20px;
        background: #ff6b35;
        color: white;
        border: none;
        border-radius: 25px;
        font-weight: bold;
        font-size: 15px;
        cursor: pointer;
        z-index: 9999;
        box-shadow: 0 4px 15px rgba(255, 107, 53, 0.7);
        display: block;
    `;
    
    // Acci√≥n al tocar
    botonInstalar.onclick = function() {
        if (window.deferredPrompt) {
            window.deferredPrompt.prompt();
            window.deferredPrompt.userChoice.then(function(choiceResult) {
                if (choiceResult.outcome === 'accepted') {
                    // MARCA como instalada
                    localStorage.setItem('pwa_instalada', 'true');
                    botonInstalar.style.display = 'none';
                    console.log('‚úÖ Marcada como instalada');
                }
            });
        } else {
            alert('PARA INSTALAR:\n\n' +
                  '1. Toca los 3 puntitos (‚ãÆ)\n' +
                  '2. Busca "Agregar a la pantalla"\n' +
                  '3. ¬°Listo!\n\n' +
                  '‚úÖ Se guarda en tu celular\n' +
                  '‚úÖ Funciona sin internet\n' +
                  '‚úÖ Carga m√°s r√°pido');
        }
    };
    
    document.body.appendChild(botonInstalar);
    console.log('‚úÖ Bot√≥n instalaci√≥n creado');
   }

   // Crear bot√≥n cuando cargue la p√°gina
   window.addEventListener('load', crearBotonInstalacion);

   // Detectar cuando se instala
    window.addEventListener('appinstalled', function() {
    console.log('üéâ PWA instalada exitosamente');
    
    // Marcar como instalada
    localStorage.setItem('pwa_instalada', 'true');
    
    // Ocultar bot√≥n si existe
    if (botonInstalar) {
        botonInstalar.style.display = 'none';
    }
});
</script>
</body>

</html>




